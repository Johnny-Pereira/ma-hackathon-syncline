name: Compare Branches

on:
  push:
    paths:
      - 'folder/**'
    branches:
      - "*"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Configure AWS credentials
      run: |
        aws configure set aws_access_key_id ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws configure set aws_secret_access_key ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws configure set region us-east-1

    - name: Checkout base branch
      uses: actions/checkout@v2
      with:
        ref: 'main'

    - name: copy current branch name
      run: |
        bash
        current_branch = $(git rev-parse --abbrev-ref HEAD)

    - name: Checkout compare branch
      uses: actions/checkout@v2
      with:
        ref: $current_branch
        path: './branch-to-compare'

    - name: Compare differences
      run: |
        git diff --color ./ ./branch-to-compare > diff.txt
        if [ -s diff.txt ]; then
          echo "Differences found and written to diff.txt"
        else
          echo "No differences found."
        fi

    - name: Upload differences
      uses: actions/upload-artifact@v2
      with:
        name: diff-output
        path: diff.txt
